{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : true,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "166725c0-1bf9-11ef-9440-3ff7cc14de6a"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "16587fc0-1bf9-11ef-9440-3ff7cc14de6a"
    },
    "name" : "Stall Waiting Time",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 1,
      "type" : "True"
    }, {
      "fromIndex" : 1,
      "toIndex" : 6,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 3,
      "toIndex" : 4,
      "type" : "Success"
    }, {
      "fromIndex" : 4,
      "toIndex" : 12,
      "type" : "Success"
    }, {
      "fromIndex" : 5,
      "toIndex" : 8,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 7,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 10,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 8,
      "toIndex" : 3,
      "type" : "True"
    }, {
      "fromIndex" : 9,
      "toIndex" : 2,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 9,
      "type" : "True"
    } ],
    "firstNodeIndex" : 0,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 312,
        "layoutY" : 146
      },
      "configuration" : {
        "originatorTypes" : [ "DEVICE", "ASSET" ]
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "166725c0-1bf9-11ef-9440-3ff7cc14de6a"
      },
      "name" : "Device",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbOriginatorTypeFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 585,
        "layoutY" : 137
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "if(msgType === 'POST_TELEMETRY_REQUEST') {\r\n    if(metadata.deviceType === 'Occupancy Sensor') {\r\n        return true ;\r\n    } \r\n}\r\nreturn false;",
        "tbelScript" : "return msg.temperature > 20;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "1667c200-1bf9-11ef-9440-3ff7cc14de6a"
      },
      "name" : "Device Filter",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1088,
        "layoutY" : 516
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "1668fa81-1bf9-11ef-9440-3ff7cc14de6a"
      },
      "name" : "Save Time Stamp",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 967,
        "layoutY" : 350
      },
      "configuration" : {
        "inputValueKey" : "occ",
        "outputValueKey" : "delta",
        "useCache" : true,
        "addPeriodBetweenMsgs" : true,
        "periodValueKey" : "Wait_Time",
        "round" : null,
        "tellFailureIfDeltaIsNegative" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "166948a0-1bf9-11ef-9440-3ff7cc14de6a"
      },
      "name" : "Delta Waiting Time",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.CalculateDeltaNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1152,
        "layoutY" : 235
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "// Convert Wait_Time to minutes and get the integer part (whole minutes)\nmsg.Wait_Time = msg.Wait_Time / 60003;\n\n\nreturn { msg: msg, metadata: metadata, msgType: msgType };\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "1caa4ea0-4686-11ef-aac4-6f8a84baac26"
      },
      "name" : "time converter",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 569,
        "layoutY" : 260
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "msg.previousocc= metadata.occupancy.replace(/\\\"/g, '');\n\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "13d4f770-4f65-11ef-aac4-6f8a84baac26"
      },
      "name" : "removing unwanted character from string",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 870,
        "layoutY" : 142
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "\nif(msg.occupancy == \"occupied\"){\n    msg.occ=1;\n}\n\nelse{\n    msg.occ=0;\n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "57bb5cd0-4f66-11ef-aac4-6f8a84baac26"
      },
      "name" : "change occupancy String to Boolean no",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 304,
        "layoutY" : 257
      },
      "configuration" : {
        "latestTsKeyNames" : [ "occupancy" ],
        "aggregation" : "NONE",
        "fetchMode" : "LAST",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 24,
        "startIntervalTimeUnit" : "HOURS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "SECONDS"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "2fd25dc0-4f6d-11ef-aac4-6f8a84baac26"
      },
      "name" : "Previous Data",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 876,
        "layoutY" : 244
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "/*if(msg.occ==0 && msg.previousocc == \"occupied\"){\n    return true;\n}\nelse{\n    return false;\n}\n\n*/\n\n\n\n\n\nif(msg.occ==1 && msg.previousocc == \"occupied\"){\n    return false;\n}\n\nelse if(msg.occ==0 && msg.previousocc == \"vacant\"){\n    return false;\n}\n\nelse if(msg.occ==1 && msg.previousocc == \"vacant\"){\n    return false;\n}\n\n\n\nreturn true;\n\n\n/*\n\nif (msg.occ === 1 && msg.previousocc === \"occupied\") {\n    // Already occupied, no change\n    return false;\n} else if (msg.occ === 0 && msg.previousocc === \"vacant\") {\n    // Already vacant, no change\n    return false;\n} else if (msg.occ === 1 && msg.previousocc === \"vacant\") {\n    // Person just arrived, start timing\n    return false;\n} else if (msg.occ === 0 && msg.previousocc === \"occupied\") {\n    // Person just left, calculate delta time\n   \n    return true;\n}\n\nreturn false;\n*/\n",
        "tbelScript" : "return msg.temperature > 20;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "9352f8e0-4f6e-11ef-aac4-6f8a84baac26"
      },
      "name" : "con",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1388,
        "layoutY" : 375
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "if(msg.previousocc == \"vacant\"){\n    \n    msg.Wait_Time=0.05;\n}\n\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "c3394810-4f6f-11ef-aac4-6f8a84baac26"
      },
      "name" : "reseting waiting time counter",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1171,
        "layoutY" : 148
      },
      "configuration" : {
        "ruleChainId" : "7964d350-5fa8-11ef-ae93-f7fbfc2df8a7"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f0bf9390-604d-11ef-ae93-f7fbfc2df8a7"
      },
      "name" : "stall count",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.flow.TbRuleChainInputNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1362,
        "layoutY" : 499
      },
      "configuration" : {
        "ruleChainId" : "5bf41390-4cec-11ef-aac4-6f8a84baac26"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e6727220-6068-11ef-ae93-f7fbfc2df8a7"
      },
      "name" : "Washroom Avg Wait time",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.flow.TbRuleChainInputNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1416,
        "layoutY" : 265
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return msg.Wait_Time < 70;",
        "tbelScript" : "return msg.temperature > 20;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f5416470-62b9-11ef-be79-2954bfc55759"
      },
      "name" : "dfdrer",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}